# Проект № 3
# Общая задача: создать скрипт для формирования витрины на основе логов web-сайта.
# Подробное описание задачи:

Разработать скрипт формирования витрины следующего содержания:

Суррогатный ключ устройства

Название устройства

Количество пользователей

Доля пользователей данного устройства от общего числа пользователей

Количество совершенных действий для данного устройства

Доля совершенных действий с данного устройства относительно других устройств

Список из 5 самых популярных браузеров, используемых на данном устройстве различными пользователями, с указанием доли использования для данного браузера относительно остальных браузеров 

Количество ответов сервера, отличных от 200 на данном устройстве

Для каждого из ответов сервера, отличных от 200, сформировать поле, в котором будет содержаться количество ответов данного типа

При помощи файла docker_compose.yaml можем развернуть сервис, который будет собирать данные из файла access.log

# Состав сервиса:
Оркестратор - Apache Airflow 2.7.2
База данных - Clickhouse

# описание дагов:
Используется один даг с названием файла - log_parser.py и названием в вэб-интерфейсе - log-parser
Даг состоит из двух частей: get_data и insert_data
get_data - читает файл access.log, при помощи регулярки и библиотеки httpagentparser извлекает необходимую информацию и записывает в файл parsed_log.csv
insert_data - читает файл parsed_logs.csv и записывает данные в таблицу log_info


# Описание базы данных 
# В базе присутствуют следующие таблицы:
clients_info - информация об устройствах и пользователях
log_info - информация из файла с логами

# описание полей таблицы clients_info:
client - IP-адрес пользователя
hostname - IP-адрес устройства
alias_list - не понял что это, но наверное что-то нужное 
addres_list - аналогично полю выше...

# описание полей таблицы log_info:
IP - IP-адрес пользователя
timestamp - время запроса (обращения к сайту) 
response - тип ответа
numbers - размер пакета (не уверен)
device_name - название устройства с которого сделали запрос к сайту
browser - название браузера

# Так же в базе есть следующие представления:
twin_table - соединенные вместе таблицы clients_info и log_info по столбцам clients_info.client и log_info.IP 
first_view - вьюха с 7-ю пунктами из задания
second_view - вьюха с информацией об используемых браузерах
third_view - вьюха с типами ответов сайта

# описание полей first_view:
surr_key - суррогатный ключ
hostname - IP-адрес устройства
user_percent_by_host - Доля пользователей данного устройства от общего числа пользователей
cnt_actions - Количество совершенных действий для данного устройства
percent_from_all - Доля совершенных действий с данного устройства относительно других устройств
not_200_sum - Количество ответов сервера, отличных от 200 на данном устройстве
# описание полей second_view:
hostname - IP-адрес устройства
browser - название браузера
brows_actions - количество действий данного браузера на данном устройства
cnt_brws_on_ip - количество использованных браузеров на данном устройстве
percent_by_browser_action - доли использования для данного браузера относительно остальных браузеров на данном усторйстве
# описание полей third_view:
 response - тип ответа от сервера
 total__by_response - количество ответов данного типа